<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>james gadoury|blog</title>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="theme/css/style.css">
</head>
<body>
  <header>
    <nav class="top-nav">
      <ul>
        <li><a href="https://jamesgadoury.github.io/">james gadoury | home</a></li>
        <li><a href="https://jamesgadoury.github.io/blog/">blog</a></li>
      </ul>
    </nav>

    <nav class="secondary-nav">
      <ul>
      </ul>
    </nav>
  </header>

  <main>
  <article>
    <h1>agentic-convo-workflow</h1>
    <div class="content">
      <p>I got really excited last year as agentic workflows were becoming more popular.... and I did nothing about it :) </p>
<p>After watching <a href="https://www.youtube.com/watch?v=KrRD7r7y7NY">Andrew Ng's talk on this subject</a> recently, I decided to dedicate time every week to learn more about how to build agentic workflows.</p>
<p>My first toy project is this simple workflow using langgraph to start a convo between two personas: a patient "John" and a therapist "Sarah".</p>
<p>I also played around with prompting an agent to decide when to end the workflow (so that it didn't just run forever).</p>
<p>It worked surprisingly well on my first try and required almost no effort from me to setup.
See this example of a few iterations of the loop (note that the [] below indicate different nodes in the langchain):</p>
<div class="highlight"><pre><span></span><code><span class="o">----------------------------</span>
<span class="o">[</span><span class="n">john_starts</span><span class="o">]</span><span class="err">:</span>
<span class="p">(</span><span class="n">nervously</span><span class="w"> </span><span class="n">taking</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">seat</span><span class="p">)</span><span class="w"> </span><span class="n">Ah</span><span class="p">,</span><span class="w"> </span><span class="n">hi</span><span class="w"> </span><span class="n">Sarah</span><span class="p">.</span><span class="w"> </span><span class="n">I</span><span class="s1">&#39;m...I&#39;</span><span class="n">m</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">start</span><span class="p">,</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">honest</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">pausing</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">moment</span><span class="p">)</span><span class="w"> </span><span class="n">I</span><span class="s1">&#39;ve been feeling really overwhelmed lately. Just like everything is piling up on me and I don&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">manage</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="ow">all</span><span class="p">.</span><span class="w"> </span><span class="k">Work</span><span class="s1">&#39;s been stressing me out, my relationship with my family&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">strained</span><span class="p">...</span><span class="n">just</span><span class="w"> </span><span class="n">feeling</span><span class="w"> </span><span class="ow">like</span><span class="w"> </span><span class="n">I</span><span class="s1">&#39;m stuck in this rut and can&#39;</span><span class="n">t</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">sighing</span><span class="p">)</span><span class="w"> </span><span class="ow">And</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">worst</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="k">is</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">feel</span><span class="w"> </span><span class="ow">like</span><span class="w"> </span><span class="n">I</span><span class="s1">&#39;ve lost sight of who I am and what makes me happy. It&#39;</span><span class="n">s</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">become</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="n">mess</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">looking</span><span class="w"> </span><span class="n">down</span><span class="p">,</span><span class="w"> </span><span class="n">fidgeting</span><span class="w"> </span><span class="n">slightly</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">hands</span><span class="p">)</span><span class="w"> </span><span class="n">Sorry</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t mean to just dump all this on you right off the bat...it&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">building</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">now</span><span class="p">.</span>


<span class="o">----------------------------</span>
<span class="o">[</span><span class="n">sarah_responds</span><span class="o">]</span><span class="err">:</span>
<span class="n">John</span><span class="p">,</span><span class="w"> </span><span class="n">thank</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sharing</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lot</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">courage</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">acknowledge</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">feelings</span><span class="p">.</span><span class="w"> </span><span class="n">I</span><span class="s1">&#39;m here to listen and help in any way I can.</span>

<span class="s1">First, let&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">take</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deep</span><span class="w"> </span><span class="n">breath</span><span class="w"> </span><span class="n">together</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">acknowledge</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">it</span><span class="s1">&#39;s okay to feel overwhelmed. It sounds like you&#39;</span><span class="n">re</span><span class="w"> </span><span class="n">carrying</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">heavy</span><span class="w"> </span><span class="k">load</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">it</span><span class="s1">&#39;s understandable that you&#39;</span><span class="n">re</span><span class="w"> </span><span class="n">feeling</span><span class="w"> </span><span class="n">stuck</span><span class="p">.</span><span class="w"> </span><span class="n">Can</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">tell</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">what</span><span class="s1">&#39;s been stressing you out at work? Has there been a specific incident or situation that&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">weighing</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">mind</span><span class="vm">?</span>

<span class="ow">And</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t worry about &quot;dumping&quot; anything on me – this is a safe space for you to express yourself without judgment. We&#39;</span><span class="n">ll</span><span class="w"> </span><span class="n">take</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nc">time</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">I</span><span class="s1">&#39;m here to support you in unraveling the tangles of your life.</span>

<span class="s1">(By the way, would you like a glass of water or a comfortable pillow before we continue?)</span>


<span class="s1">----------------------------</span>
<span class="s1">[evaluate_if_end_conversation]:</span>
<span class="s1">Let&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">analyze</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="nl">step</span><span class="p">:</span>

<span class="mf">1.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">thanking</span><span class="w"> </span><span class="n">John</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sharing</span><span class="w"> </span><span class="n">his</span><span class="w"> </span><span class="n">feelings</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">expressing</span><span class="w"> </span><span class="n">appreciation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">his</span><span class="w"> </span><span class="n">courage</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">doing</span><span class="w"> </span><span class="n">so</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">suggests</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">invested</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">conversation</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">willing</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">listen</span><span class="p">.</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">They</span><span class="s1">&#39;re acknowledging John&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">emotional</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">offering</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">calming</span><span class="w"> </span><span class="n">presence</span><span class="p">,</span><span class="w"> </span><span class="n">encouraging</span><span class="w"> </span><span class="n">him</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">open</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">what</span><span class="s1">&#39;s stressing him out at work. This shows that they&#39;</span><span class="n">re</span><span class="w"> </span><span class="n">actively</span><span class="w"> </span><span class="n">engaged</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">interested</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">understanding</span><span class="w"> </span><span class="n">John</span><span class="s1">&#39;s situation.</span>

<span class="s1">3. By emphasizing that it&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">safe</span><span class="w"> </span><span class="nf">space</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">John</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="n">himself</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="n">judgment</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">creating</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">supportive</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">implies</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">they</span><span class="s1">&#39;re willing to continue the conversation as long as John needs it.</span>

<span class="s1">4. The offer of a glass of water or a comfortable pillow is a thoughtful gesture, indicating that the person is focused on John&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">comfort</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">willing</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">accommodate</span><span class="w"> </span><span class="n">his</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">proceeding</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">conversation</span><span class="p">.</span>

<span class="n">Given</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">observations</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">seems</span><span class="w"> </span><span class="n">clear</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">conversation</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">rather</span><span class="w"> </span><span class="n">investing</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">effort</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">making</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">John</span><span class="w"> </span><span class="n">feels</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">ease</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">continues</span><span class="w"> </span><span class="n">sharing</span><span class="w"> </span><span class="n">his</span><span class="w"> </span><span class="n">thoughts</span><span class="p">.</span><span class="w"> </span><span class="n">Therefore</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">CONTINUE</span><span class="p">.</span>
</code></pre></div>

<p>Skipping a bunch of iterations, we eventually see the evaluate_if_end_conversation node correctly identify a natural end to conversation, and output accordingly. However, due to my configuration of the graph, it ends prematurely before "John" can respond:</p>
<div class="highlight"><pre><span></span><code><span class="o">----------------------------</span>
<span class="o">[</span><span class="n">john_responds</span><span class="o">]</span><span class="err">:</span>
<span class="p">(</span><span class="n">Sighing</span><span class="w"> </span><span class="n">slightly</span><span class="p">)</span><span class="w"> </span><span class="n">Yeah</span><span class="p">...</span><span class="w"> </span><span class="n">actually</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">mention</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">few</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">I</span><span class="s1">&#39;ve felt like they&#39;</span><span class="n">re</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">really</span><span class="w"> </span><span class="n">listening</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">ideas</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="s1">&#39;s always been kind of subtle, but it&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="nf">left</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="n">feeling</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="n">frustrated</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">like</span><span class="w"> </span><span class="n">I</span><span class="s1">&#39;m not being taken seriously.</span>

<span class="s1">I remember one time in particular where we were working on a project together and I had spent hours researching and preparing this data analysis that I thought was really insightful. When I presented my findings to the team, they kind of brushed it off and moved on without even acknowledging the effort I put into it. It felt like they weren&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">taking</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="n">seriously</span><span class="p">.</span>

<span class="p">(</span><span class="n">Looking</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">moment</span><span class="p">)</span><span class="w"> </span><span class="k">To</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">honest</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="s1">&#39;s made me question whether or not my contributions are valued in our team. And when this latest incident happened with their comment about &quot;just&quot; doing my job, it just brought up all these feelings of insecurity and self-doubt.</span>

<span class="s1">(Looking back at Sarah) I guess what I&#39;</span><span class="n">m</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">say</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">it</span><span class="s1">&#39;s not just one incident that&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">bothering</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="err">–</span><span class="w"> </span><span class="n">it</span><span class="s1">&#39;s a pattern of feeling like I&#39;</span><span class="n">m</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">heard</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">taken</span><span class="w"> </span><span class="n">seriously</span><span class="p">.</span><span class="w"> </span><span class="ow">And</span><span class="w"> </span><span class="n">it</span><span class="s1">&#39;s making me wonder if maybe I need to re-evaluate how I&#39;</span><span class="n">m</span><span class="w"> </span><span class="n">approaching</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">interactions</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">colleague</span><span class="p">...</span><span class="w"> </span><span class="p">(</span><span class="k">trailing</span><span class="w"> </span><span class="k">off</span><span class="p">,</span><span class="w"> </span><span class="n">looking</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">guidance</span><span class="p">)</span>


<span class="o">----------------------------</span>
<span class="o">[</span><span class="n">sarah_responds</span><span class="o">]</span><span class="err">:</span>
<span class="n">John</span><span class="p">,</span><span class="w"> </span><span class="n">thank</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sharing</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">me</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">lot</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">courage</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">honest</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">those</span><span class="w"> </span><span class="n">feelings</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">appreciate</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">trust</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">conversation</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="s1">&#39;s clear that this isn&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">incident</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">rather</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">feeling</span><span class="w"> </span><span class="n">undervalued</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">unappreciated</span><span class="p">.</span>

<span class="n">I</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">acknowledge</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">effort</span><span class="w"> </span><span class="n">you</span><span class="s1">&#39;re putting into trying to understand and address these feelings. That takes a lot of self-awareness and introspection.</span>

<span class="s1">As we&#39;</span><span class="n">ve</span><span class="w"> </span><span class="n">discussed</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">concerns</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">think</span><span class="w"> </span><span class="n">it</span><span class="s1">&#39;s clear that this is an important issue for you to address, not just for your own well-being but also for your professional growth and satisfaction.</span>

<span class="s1">Before our session comes to a close today, I want to offer some encouragement and support. It might be helpful to continue exploring these feelings and interactions with your colleague in future sessions. Perhaps we can work on developing strategies to help you assert yourself more effectively and build confidence in your contributions.</span>

<span class="s1">For now, though, let&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">take</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">moment</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">acknowledge</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="n">we</span><span class="s1">&#39;ve made today. You&#39;</span><span class="n">ve</span><span class="w"> </span><span class="n">taken</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">recognizing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">patterns</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">affecting</span><span class="w"> </span><span class="n">you</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">that</span><span class="s1">&#39;s something to be proud of.</span>

<span class="s1">Our time is up for today, but I&#39;</span><span class="n">m</span><span class="w"> </span><span class="n">looking</span><span class="w"> </span><span class="n">forward</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">continuing</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="n">together</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">sessions</span><span class="p">.</span><span class="w"> </span><span class="n">How</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">feel</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">we</span><span class="s1">&#39;ve discussed today?</span>


<span class="s1">----------------------------</span>
<span class="s1">[evaluate_if_end_conversation]:</span>
<span class="s1">Let&#39;</span><span class="n">s</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">language</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">tone</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">text</span><span class="err">:</span>

<span class="o">*</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">phrases</span><span class="w"> </span><span class="ss">&quot;Our time is up for today&quot;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ss">&quot;before our session comes to a close today&quot;</span><span class="w"> </span><span class="n">suggest</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">speaker</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">aware</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">conversation</span><span class="s1">&#39;s scheduled end and is preparing to wrap things up.</span>
<span class="s1">* The use of summary statements (&quot;It&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">clear</span><span class="w"> </span><span class="n">that</span><span class="p">...</span><span class="ss">&quot;) and encouraging language (&quot;</span><span class="n">I</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">offer</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="n">encouragement</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">support</span><span class="ss">&quot;) implies that the speaker is attempting to provide closure and reassurance.</span>
<span class="ss">* The transition to a question (&quot;</span><span class="n">How</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">feel</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">we</span><span class="err">&#39;</span><span class="n">ve</span><span class="w"> </span><span class="n">discussed</span><span class="w"> </span><span class="n">today</span><span class="vm">?</span><span class="err">&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">seen</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">elicit</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">ending</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">conversation</span><span class="p">.</span>

<span class="n">Considering</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">points</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">seems</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">conversation</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">polite</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">supportive</span><span class="w"> </span><span class="n">manner</span><span class="p">.</span><span class="w"> </span><span class="n">Therefore</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="k">output</span><span class="err">:</span><span class="w"> </span><span class="n">DONE</span>
</code></pre></div>

<p>Anyways, this is very exciting. All I want to do is write agentic workflows now :)</p>
<p>Here's all the code if interested:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">argparse</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">ArgumentParser</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">json</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">dumps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Final</span><span class="p">,</span><span class="w"> </span><span class="nb">List</span><span class="p">,</span><span class="w"> </span><span class="n">Literal</span><span class="p">,</span><span class="w"> </span><span class="n">TypedDict</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">HumanMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_ollama</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">ChatOllama</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">END</span><span class="p">,</span><span class="w"> </span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="n">StateGraph</span>

<span class="n">JOHN_STARTS</span><span class="p">:</span><span class="w"> </span><span class="n">Final</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;john_starts&quot;</span>
<span class="n">SARAH_RESPONDS</span><span class="p">:</span><span class="w"> </span><span class="n">Final</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sarah_responds&quot;</span>
<span class="n">JOHN_RESPONDS</span><span class="p">:</span><span class="w"> </span><span class="n">Final</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;john_responds&quot;</span>
<span class="n">EVALUATE_IF_END_CONVERSATION</span><span class="p">:</span><span class="w"> </span><span class="n">Final</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;evaluate_if_end_conversation&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<span class="w">    </span><span class="n">responses</span><span class="p">:</span><span class="w"> </span><span class="nb">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="w">    </span><span class="n">convo_iter</span><span class="p">:</span><span class="w"> </span><span class="nb">int</span>


<span class="k">def</span><span class="w"> </span><span class="nf">print_agent_step</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">):</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">node_name</span><span class="si">}</span><span class="s2">]:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">john_starts</span><span class="p">(</span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">ChatOllama</span><span class="p">):</span>
<span class="w">    </span><span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You are John. You just walked in to your therapist Sarah&#39;s office. Tell her how you are feeling.</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">([</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">prompt</span><span class="p">)])</span>
<span class="w">    </span><span class="n">print_agent_step</span><span class="p">(</span><span class="n">JOHN_STARTS</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">)</span>

<span class="w">    </span><span class="k">assert</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">str</span>
<span class="w">    </span><span class="n">responses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">[</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">responses</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;convo_iter&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;convo_iter&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">john_responds</span><span class="p">(</span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">ChatOllama</span><span class="p">):</span>
<span class="w">    </span><span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You are John. You are talking to your therapist Sarah. Respond to what your therapist said:</span>

<span class="s2">    </span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">([</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">prompt</span><span class="p">)])</span>
<span class="w">    </span><span class="n">print_agent_step</span><span class="p">(</span><span class="n">JOHN_RESPONDS</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">)</span>

<span class="w">    </span><span class="k">assert</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">str</span>
<span class="w">    </span><span class="n">responses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">[</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">responses</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;convo_iter&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;convo_iter&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">sarah_responds</span><span class="p">(</span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">ChatOllama</span><span class="p">):</span>
<span class="w">    </span><span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You are Sarah. You are a therapist.</span>

<span class="s2">    You are talking to John, your patient, while in your office.</span>

<span class="s2">    When it seems like the conversation has reached a natural conclusion,</span>
<span class="s2">    respectfully end the conversation.</span>

<span class="s2">    Respond to what your patient, John, said:</span>

<span class="s2">    </span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">([</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">prompt</span><span class="p">)])</span>
<span class="w">    </span><span class="n">print_agent_step</span><span class="p">(</span><span class="n">SARAH_RESPONDS</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">)</span>

<span class="w">    </span><span class="k">assert</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">str</span>
<span class="w">    </span><span class="n">responses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;responses&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">[</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">responses</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;convo_iter&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;convo_iter&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_if_end_conversation</span><span class="p">(</span>
<span class="w">    </span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">:</span><span class="w"> </span><span class="n">ChatOllama</span>
<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Literal</span><span class="p">[</span><span class="n">JOHN_RESPONDS</span><span class="p">,</span><span class="w"> </span><span class="n">END</span><span class="p">]:</span><span class="w">  </span><span class="c1"># type: ignore</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;convo_iter&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;end&quot;</span>

<span class="w">    </span><span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Evaluate if this person is trying to end the conversation:</span>
<span class="s2">    </span><span class="si">{</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span>

<span class="s2">    If they are trying to end conversation, output DONE, otherwise output CONTINUE</span>

<span class="s2">    Think about it for a few steps.</span>
<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="o">.</span><span class="n">invoke</span><span class="p">([</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">prompt</span><span class="p">)])</span>
<span class="w">    </span><span class="n">print_agent_step</span><span class="p">(</span><span class="n">EVALUATE_IF_END_CONVERSATION</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">)</span>

<span class="w">    </span><span class="k">assert</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">str</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="s2">&quot;CONTINUE&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">JOHN_RESPONDS</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="s2">&quot;DONE&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">END</span>

<span class="w">    </span><span class="c1"># Fallback if LLM didn&#39;t generate any of the desired text strings</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">JOHN_RESPONDS</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">output_dir</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="p">):</span>
<span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChatOllama</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>

<span class="w">    </span><span class="n">graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StateGraph</span><span class="p">(</span><span class="n">State</span><span class="p">)</span>
<span class="w">    </span><span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">JOHN_STARTS</span><span class="p">,</span><span class="w"> </span><span class="n">partial</span><span class="p">(</span><span class="n">john_starts</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">))</span>
<span class="w">    </span><span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">JOHN_RESPONDS</span><span class="p">,</span><span class="w"> </span><span class="n">partial</span><span class="p">(</span><span class="n">john_responds</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">))</span>
<span class="w">    </span><span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">SARAH_RESPONDS</span><span class="p">,</span><span class="w"> </span><span class="n">partial</span><span class="p">(</span><span class="n">sarah_responds</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">))</span>

<span class="w">    </span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span><span class="w"> </span><span class="n">JOHN_STARTS</span><span class="p">)</span>
<span class="w">    </span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">JOHN_STARTS</span><span class="p">,</span><span class="w"> </span><span class="n">SARAH_RESPONDS</span><span class="p">)</span>
<span class="w">    </span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">JOHN_RESPONDS</span><span class="p">,</span><span class="w"> </span><span class="n">SARAH_RESPONDS</span><span class="p">)</span>
<span class="w">    </span><span class="n">graph</span><span class="o">.</span><span class="n">add_conditional_edges</span><span class="p">(</span>
<span class="w">        </span><span class="n">SARAH_RESPONDS</span><span class="p">,</span><span class="w"> </span><span class="n">partial</span><span class="p">(</span><span class="n">evaluate_if_end_conversation</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">compiled_graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graph</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compiled_graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;responses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="s2">&quot;convo_iter&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>

<span class="w">    </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">output_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="w">        </span><span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="w">    </span><span class="k">with</span><span class="w"> </span><span class="nb">open</span><span class="p">(</span><span class="n">output_dir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="sa">f</span><span class="s2">&quot;graph_execution_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="p">:</span>
<span class="w">        </span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>


<span class="k">if</span><span class="w"> </span><span class="vm">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="n">cli</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ArgumentParser</span><span class="p">(</span>
<span class="w">        </span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Run therapy conversation graph with specified Ollama model&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">cli</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="w">        </span><span class="s2">&quot;--model_name&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<span class="w">        </span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;vanilj/llama-3.1-70b-instruct-lorablated-iq2_xs&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;Ollama model name to use (default: </span><span class="si">%(default)s</span><span class="s2">)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">cli</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="w">        </span><span class="s2">&quot;--output-dir&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./outputs&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;dir to save outputs&quot;</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cli</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="w">    </span><span class="n">main</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span><span class="w"> </span><span class="n">output_dir</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>
</code></pre></div>
    </div>
  </article>
  <p class="post-date">Apr 27, 2025</p>
  <p class="authors">authored by
        james gadoury  </p>
  </main>

  <footer>
    <p>©  james gadoury. All rights reserved.</p>
  </footer>
</body>
</html>
